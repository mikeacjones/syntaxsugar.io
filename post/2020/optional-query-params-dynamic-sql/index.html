<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.09b7808498e5b23cd873.css" id="gatsby-global-css">.codeWrapper{position:relative;max-width:98vw;margin-left:auto;margin-right:auto}.ConfettiWrapper{position:absolute;top:0;right:0;z-index:9}.CodeLanguageStub{left:8px;box-shadow:"none";-webkit-user-select:none;-ms-user-select:none;user-select:none}.CodeLanguageStub,.CopyCodeButton{position:absolute;top:0;margin:0;border:none;padding:8px 12px;background:#52307c;border-bottom-left-radius:8px;border-bottom-right-radius:8px;color:#ffffd2;font-size:14px;font-family:Ubuntu Mono,monospace;line-height:1;z-index:90}.CopyCodeButton{right:8px;box-shadow:none;text-decoration:none;cursor:pointer}.ZoomableImage{max-width:98vw;width:700px;overflow:hidden;cursor:pointer;margin-left:auto;margin-right:auto;border:1px solid #3b415c}.ZoomableImage-enlarged{position:fixed;top:0;left:0;right:0;bottom:0;cursor:pointer;display:flex;padding:50px;z-index:100;background-color:rgba(0,0,0,.8)}.ZoomableImage-enlarged img,.ZoomableImage img{width:100%;height:auto}#SocialIcons{height:60px;font-size:25px;width:100%;display:flex;justify-content:space-evenly}#SocialIcons i{cursor:pointer;transition:all .5s ease}#SocialIcons i:hover{color:#fff;transform:scale(1.3)}#MenuItems{list-style:none;font-size:1.2rem}#MenuItems a{text-decoration:none}#MenuItems a li{padding-right:1rem;margin-bottom:1rem;transition:border-width .5s ease}#MenuItems a li:after{content:"";display:block;width:0;height:1px;background:#ffffd2;transition:width .3s}#MenuItems a.active li:after,#MenuItems a:hover li:after{width:100%;padding-right:1rem}#AboutMe{margin-top:100px;flex:1 1 auto;display:flex;flex-direction:column;align-items:center}#AboutMe-ProfilePicture{width:70%;height:auto;margin-left:auto;margin-right:auto;transition:all .5s ease}#AboutMe-ProfilePicture:hover{transform:scale(1.1)}#AboutMe-ProfilePicture img{width:100%;-ms-user-select:none;user-select:none;-webkit-user-drag:none;-moz-user-select:none;-webkit-user-select:none}#AboutMe-MenuItems{width:100%;display:flex;flex-direction:column;align-items:flex-end}.SideBarWrapper{flex:0 0 18rem;z-index:98}#SideBar{background-color:#3b415c;color:#ffffd2;position:fixed;width:18rem;height:100%;display:flex;flex-direction:column}@media only screen and (max-width:1000px) and (-webkit-min-device-pixel-ratio:2){.SideBarWrapper{flex:0 0}#SideBar{transition:all .5s ease;transform:translateX(-18rem)}}@media only screen and (max-width:1000px) and (-webkit-min-device-pixel-ratio:2){#ContentWrapper{margin-top:60px}}#SideBarToggle{background-color:#3b415c;color:#ffffd2;font-size:2.5rem;border-bottom:1px solid #ffffd2}#SideBarToggle-checkbox{display:none}#SideBarToggleWrapper{display:none;width:100%;flex:0 0 50px;z-index:99;position:fixed;-ms-user-select:none;user-select:none;-webkit-user-select:none;-moz-user-select:none}.toggle{padding-left:10px;justify-self:center;cursor:pointer}#SideBarToggle{width:100%}@media only screen and (max-width:1000px) and (-webkit-min-device-pixel-ratio:2){#SideBarToggleWrapper{display:block}#SideBarToggle-checkbox:checked+#SideBar{transform:translateX(0)}}body,html{margin:0;padding:0;font-family:Titillium Web,sans-serif;background-color:#efefef}a{color:inherit;-webkit-user-drag:none}#Layout{display:flex;flex-direction:row;min-height:100vh;overflow:hidden}#Layout-ContentWrapper{flex:1 1 auto;display:flex;flex-direction:column}.autolink-header.before{position:absolute;top:0;left:0;transform:translateX(-100%);padding-right:4px;display:none}.paging-links{width:100%;text-align:center;margin-top:30px}.paging-links a{text-decoration:none;font-size:1.2rem;background-color:#3b415c;color:#ffffd2;border-radius:8px;padding:8px;margin:4px}.paging-links a.disabled{background-color:#ccc;cursor:not-allowed}h1:hover .autolink-header.before,h2:hover .autolink-header.before,h3:hover .autolink-header.before,h4:hover .autolink-header.before,h5:hover .autolink-header.before,h6:hover .autolink-header.before{display:block}code{font-family:Ubuntu Mono,monospace;font-size:12px}.grvsc-code{padding-top:25px}.grvsc-line{white-space:pre-wrap}code:not(.grvsc-code){display:inline-block;white-space:pre-wrap;padding:5px;margin:5px;border-radius:5px;background-color:#efefef}.div-paragraph{margin:30px 0}blockquote{border:1px solid #cdcdcd;border-left-width:10px;padding-left:5px}.iframe-wrapper{width:50%;margin-left:auto;margin-right:auto}@media only screen and (max-width:1000px) and (-webkit-min-device-pixel-ratio:2){.iframe-wrapper{width:100%}}.Chip{font-size:12px;background-color:#eddbf4;padding:8px;border-radius:10px;color:#000;transition:all .5s ease;margin:4px;z-index:15;-ms-user-select:none;user-select:none;-moz-user-select:none;-webkit-user-drag:none;-webkit-user-select:none}.Chip-link{text-decoration:none;color:inherit}.Chip.active{background-color:#52307c;color:#eddbf4}.Chip:hover{transform:scale(1.15)}.PostCard{color:#52307c;background-color:#fff;padding:20px;margin:15px 20px 0;cursor:pointer;position:relative;box-shadow:0 1px 2px rgba(0,0,0,.1);border-radius:0;transition:all .6s cubic-bezier(.165,.84,.44,1);-ms-user-select:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-webkit-user-drag:none}.PostCard-description{color:#663a82}.PostCard:hover{transform:scale(1.005)}.PostCard:after{content:"";border-radius:0;position:absolute;z-index:-1;top:0;left:0;width:100%;height:100%;box-shadow:0 5px 15px rgba(0,0,0,.3);opacity:0;transition:all .6s cubic-bezier(.165,.84,.44,1)}.PostCard:hover:after{opacity:1}.PostCard-title{font-size:30px;font-weight:700}.PostCard-date{font-weight:lighter}.PostCard-tags{display:flex;flex-direction:row;margin-top:10px}.PostCard-link{z-index:10;position:absolute;top:0;left:0;right:0;bottom:0;-webkit-user-drag:none}.LabCard{width:28%;max-width:28%;margin-top:2%;white-space:pre-wrap;color:#52307c;background-color:#fff;padding:20px;cursor:pointer;box-shadow:0 1px 2px rgba(0,0,0,.1);border-radius:0;transition:all .6s cubic-bezier(.165,.84,.44,1);display:flex;flex-direction:column;justify-content:space-between;position:relative}.LabCard-link{position:absolute;top:0;left:0;right:0;bottom:0;-webkit-user-drag:none}.LabCard:hover{transform:scale(1.005)}.LabCard:after{content:"";border-radius:0;position:absolute;z-index:-1;top:0;left:0;width:100%;height:100%;box-shadow:0 5px 15px rgba(0,0,0,.3);opacity:0;transition:all .6s cubic-bezier(.165,.84,.44,1)}.LabCard:hover:after{opacity:1}.LabCard-header{display:flex;flex-direction:column;margin-bottom:20px}.LabCard-title{color:#663a82;font-size:30px}.LabCard-updated{font-size:12px;align-self:flex-start}.LabCard-body{overflow:hidden;margin-bottom:20px}.LabCard-footer{display:flex;flex-direction:row;width:100%}@media only screen and (max-width:1000px) and (-webkit-min-device-pixel-ratio:2){.LabCard{margin:15px 20px 0;width:100%;max-width:100%}}.LabCards{justify-content:space-evenly}.category-tags,.LabCards{display:flex;flex-direction:row;flex-wrap:wrap}.category-tags{margin-left:auto;margin-right:auto;width:90%;justify-content:center}.post-view{background-color:#fff;display:flex;flex-direction:column;align-items:center;min-height:100vh;font-size:1em}.post-view-content{align-self:stretch;padding:6rem}.post-view img{display:block;max-width:100%;max-height:100%;height:auto;margin-left:auto;margin-right:auto;-o-object-fit:contain;object-fit:contain}.embedVideo-container{display:block;max-width:98vw;width:700px}.embedVideo-iframe{width:100%;height:400px}.post-view-title{color:#52307c;padding:0}.post-view-title,.post-view-title h1{margin:0;word-wrap:break-word;text-align:center}.post-view-title h1{font-size:4em}.post-view-date{padding:0;font-weight:lighter;font-size:1rem;text-align:center}@media only screen and (max-device-width:800px) and (-webkit-min-device-pixel-ratio:2){.post-view-title h1{font-size:3em;padding:0;margin:0}.post-view-date{margin:0;font-size:1rem}.post-view-content{padding:0}}</style><meta name="generator" content="Gatsby 2.29.2"/><title data-react-helmet="true">Optional Query Params via Dynamic SQL - Michael Jones</title><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link data-react-helmet="true" rel="icon" type="image/svg+xml" href="/favicon.svg"/><link data-react-helmet="true" rel="manifest" href="/site.webmanifest"/><link data-react-helmet="true" rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><meta data-react-helmet="true" name="description" content="When building APIs, we typically provide the ability to sort or filter data on GET operations via query parameters. While building basic query parameters in Mulesoft is simple, expanding your API to support optional and repeatable parameters can seem daunting when you&#x27;re new to the platform. We will be building a simplistic Product System API in order to demo optional and repeatable query params. To accomplish this, we will be building dynamic (parameterized) SQL, and as a bonus wrapping this functionality into a reusable library."/><meta data-react-helmet="true" name="keywords" content="dataweave, mulesoft, sql"/><meta data-react-helmet="true" itemProp="name" content="Optional Query Params via Dynamic SQL - Michael Jones"/><meta data-react-helmet="true" itemProp="description" content="When building APIs, we typically provide the ability to sort or filter data on GET operations via query parameters. While building basic query parameters in Mulesoft is simple, expanding your API to support optional and repeatable parameters can seem daunting when you&#x27;re new to the platform. We will be building a simplistic Product System API in order to demo optional and repeatable query params. To accomplish this, we will be building dynamic (parameterized) SQL, and as a bonus wrapping this functionality into a reusable library."/><meta data-react-helmet="true" itemProp="image" content="https://syntaxsugar.io/favicon.svg"/><meta data-react-helmet="true" property="og:url" content="https://syntaxsugar.io"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="Optional Query Params via Dynamic SQL - Michael Jones"/><meta data-react-helmet="true" property="og:description" content="When building APIs, we typically provide the ability to sort or filter data on GET operations via query parameters. While building basic query parameters in Mulesoft is simple, expanding your API to support optional and repeatable parameters can seem daunting when you&#x27;re new to the platform. We will be building a simplistic Product System API in order to demo optional and repeatable query params. To accomplish this, we will be building dynamic (parameterized) SQL, and as a bonus wrapping this functionality into a reusable library."/><meta data-react-helmet="true" property="og:image" content="https://syntaxsugar.io/favicon.svg"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Optional Query Params via Dynamic SQL - Michael Jones"/><meta data-react-helmet="true" name="twitter:description" content="When building APIs, we typically provide the ability to sort or filter data on GET operations via query parameters. While building basic query parameters in Mulesoft is simple, expanding your API to support optional and repeatable parameters can seem daunting when you&#x27;re new to the platform. We will be building a simplistic Product System API in order to demo optional and repeatable query params. To accomplish this, we will be building dynamic (parameterized) SQL, and as a bonus wrapping this functionality into a reusable library."/><meta data-react-helmet="true" name="twitter:image" content="https://syntaxsugar.io/favicon.svg"/><meta data-react-helmet="true" name="msapplication-TileColor" content="#da532c"/><meta data-react-helmet="true" name="theme-color" content="#ffffff"/><link href="https://fonts.googleapis.com/css?family=Titillium+Web|Ubuntu+Mono&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/webpack-runtime-732d6374192569e2f284.js"/><link as="script" rel="preload" href="/framework-cd3e1e804d552fa282ef.js"/><link as="script" rel="preload" href="/app-22d52c2ef2be2623c7f4.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/a9a7754c-34b8923232843e7049e0.js"/><link as="script" rel="preload" href="/commons-4dbdc3f7f9faad9c4cbc.js"/><link as="script" rel="preload" href="/417f07d9c8fb71f0b05fb9fb3720dd621d3ab4d5-1102b991d7103fbe13c4.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-035094637a182b1c4701.js"/><link as="fetch" rel="preload" href="/page-data/post/2020/optional-query-params-dynamic-sql/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1375839498.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3128451518.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="Layout"><div class="SideBarWrapper"><input type="checkbox" id="SideBarToggle-checkbox" name="" value=""/><div id="SideBar"><div id="AboutMe"><a class="link-to" href="/"><div id="AboutMe-ProfilePicture"><img src="/static/profilePicture-3f7c935dcce0978397a510e419a6a0c1.png" alt=""/></div></a><h1>Michael Jones</h1><div id="AboutMe-MenuItems"><div><ul id="MenuItems"><a class="" href="/"><li>Posts</li></a><a href="/dw-cookbook"><li>DW Cookbook</li></a><a href="/labs/"><li>Labs</li></a></ul></div></div></div><div id="SocialIcons"><i><a href="https://github.com/mikeacjones" class="link-to" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" alt="github"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></i><i><a href="https://www.linkedin.com/in/michael-jones-5a870678/" class="link-to" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" alt="linkedin"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></i><i><a href="https://stackoverflow.com/users/10890536/michael-jones" class="link-to" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="stack-overflow" class="svg-inline--fa fa-stack-overflow fa-w-12 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" alt="stackoverflow"><path fill="currentColor" d="M290.7 311L95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"></path></svg></a></i></div></div></div><div id="Layout-ContentWrapper"><div id="SideBarToggleWrapper"><div id="SideBarToggle"><label for="SideBarToggle-checkbox" class="toggle">☰</label></div></div><div id="ContentWrapper"><div class="post-view"><div class="post-view-header"><div class="post-view-title"><h1>Optional Query Params via Dynamic SQL</h1><div class="post-view-date">Written on <!-- -->2020-12-25</div></div></div><div class="post-view-content"><div class="div-paragraph"><strong>Table of contents:</strong></div><ul><li><a href="#overview">Overview</a><ul><li><a href="#what-you-need">What you need</a></li><li><a href="#what-you-will-build">What you will build</a></li></ul></li><li><a href="#api-specification">API Specification</a></li><li><a href="#implementation">Implementation</a><ul><li><a href="#create-project">Create Project</a></li><li><a href="#setup-mysql-connection">Setup MySQL Connection</a></li><li><a href="#create-basic-select-and-map-data">Create Basic Select and Map Data</a></li></ul></li><li><a href="#building-dynamic-parameterized-sql">Building Dynamic Parameterized SQL</a></li><li><a href="#bonus-round---making-it-reusable">Bonus Round - Making it Reusable</a></li></ul><hr/><h1 id="overview" style="position:relative"><a href="#overview" aria-label="overview permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h1><h4 id="what-you-need" style="position:relative"><a href="#what-you-need" aria-label="what you need permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What you need:</h4><ul><li><a href="https://www.mulesoft.com/lp/dl/studio" target="_blank" rel="noreferrer">Anypoint Studio</a>.</li><li>Anypoint Platform Account - <a href="https://anypoint.mulesoft.com/login/signup?apintent=generic" target="_blank" rel="noreferrer">sign up for a trial</a></li></ul><h4 id="what-you-will-build" style="position:relative"><a href="#what-you-will-build" aria-label="what you will build permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What you will build</h4><div class="div-paragraph">We will be utilizing a MySQL database in order to build a Product System API, which we will publish to Exchange in order to utilize scaffolding; given that the focus of this article is query parameters, we will only be implementing the <code>GET</code> operation on the <code>/products</code> endpoint.</div><h1 id="api-specification" style="position:relative"><a href="#api-specification" aria-label="api specification permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API Specification</h1><ol><li>Log into <a href="https://anypoint.mulesoft.com" target="_blank" rel="noreferrer">https://anypoint.mulesoft.com</a>.</li><li>Navigate to design center</li><li>Click <code>+ Create New</code> and select <code>New API Spec</code></li><li>Give the API a title; <code>Product System API</code></li><li>In this case, our focus isn&#x27;t on designing the API itself, so choose to use <code>RAML 1.0</code> rather than the visual editor. I will be providing you the starting RAML.</li></ol><div class="div-paragraph"><div role="button" class="ZoomableImage"><img alt="create-product-api-spec.gif" src="/images/create-product-api-spec.gif"/></div></div><ol start="6"><li>Complete API specification. To start, copy the code below into your specification.</li></ol><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">raml</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="raml" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">#%RAML 1.0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">title</span><span class="mtk5">:</span><span class="mtk6"> Product System API</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">types:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">  Product:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">    type:</span><span class="mtk5"> object</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">    properties:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      id:</span><span class="mtk5"> number</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      name:</span><span class="mtk5"> string</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      description:</span><span class="mtk5"> string</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      productCode:</span><span class="mtk5"> string</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      manufactured:</span><span class="mtk5"> boolean</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      colors:</span><span class="mtk5"> string[]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      categories:</span><span class="mtk5"> string[]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      stock:</span><span class="mtk5"> number</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      safetyStockLevel:</span><span class="mtk5"> number</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      standardCost:</span><span class="mtk5"> number</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      listPrice:</span><span class="mtk5"> number</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      size:</span><span class="mtk5"> string</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      sizeUnitMeasure:</span><span class="mtk5"> string</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      weight:</span><span class="mtk5"> number</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      weightUnitMeasureCode:</span><span class="mtk5"> string</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      daysToManufacture:</span><span class="mtk5"> number</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      images:</span><span class="mtk5"> string[]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      modifiedDate:</span><span class="mtk5"> date-only</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">      createdDate:</span><span class="mtk5"> date-only</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">/products</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">get</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">description</span><span class="mtk5">:</span><span class="mtk6"> Returns a list of Products</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">responses</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk15">200:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">body</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk9">application/json</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk9">type</span><span class="mtk5">:</span><span class="mtk6"> Product[]</span></span></span></code></pre></div><div class="div-paragraph">This gives us our basic API which returns a list of products, but it would be nice to be able to filter things! Our products have a field called <code>weightUnitMeasureCode</code>, and it would be very useful to be able to filter by this code. A simple implementation might look like:</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">raml</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="raml" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">queryParameters</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">weightUnitMeasureCode</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9">type</span><span class="mtk5">:</span><span class="mtk6"> string</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9">required</span><span class="mtk5">:</span><span class="mtk6"> false</span></span></span></code></pre></div><div class="div-paragraph">The disadvantage here though is we can only filter by a single <code>weightUnitMeasureCode</code>! It would be nice to be able to specify multiple, ie: <code>?weightUnitMeasureCode=lb&amp;weightUnitMeasureCode=oz</code>. Thankfully, query parameters can be specified as repeatable. Lets go ahead and add this to our spec now:</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">raml</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container grvsc-has-line-highlighting community-material-theme-palenight" data-language="raml" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="28"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk11">/products</span><span class="mtk1">:</span><span class="mtk6"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="29"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">get</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="30"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">description</span><span class="mtk5">:</span><span class="mtk6"> Returns a list of Products</span></span></span>
<span class="grvsc-line grvsc-line-diff grvsc-line-diff-add"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="31"></span><span class="grvsc-gutter grvsc-diff-add" aria-hidden="true" data-content="+"></span><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">queryParameters</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line grvsc-line-diff grvsc-line-diff-add"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="32"></span><span class="grvsc-gutter grvsc-diff-add" aria-hidden="true" data-content="+"></span><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9">weightUnitMeasureCode</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line grvsc-line-diff grvsc-line-diff-add"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="33"></span><span class="grvsc-gutter grvsc-diff-add" aria-hidden="true" data-content="+"></span><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">type</span><span class="mtk5">:</span><span class="mtk6"> string[]</span></span></span>
<span class="grvsc-line grvsc-line-diff grvsc-line-diff-add"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="34"></span><span class="grvsc-gutter grvsc-diff-add" aria-hidden="true" data-content="+"></span><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">required</span><span class="mtk5">:</span><span class="mtk6"> false</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="35"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">responses</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="36"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk15">200:</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="37"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">body</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="38"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk9">application/json</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="39"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk9">type</span><span class="mtk5">:</span><span class="mtk6"> Product[]</span></span></span></code></pre></div><div class="div-paragraph">Another prime candidate for a query parameter is the field <code>manufactured</code>. By default, we won&#x27;t be filtering any products, so lets go ahead and add it as an optional field:</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">raml</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container grvsc-has-line-highlighting community-material-theme-palenight" data-language="raml" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="31"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">queryParameters</span><span class="mtk5">:</span><span class="mtk6"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="32"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9">weightUnitMeasureCode</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="33"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">type</span><span class="mtk5">:</span><span class="mtk6"> string[]</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="34"></span><span class="grvsc-gutter" aria-hidden="true"></span><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">required</span><span class="mtk5">:</span><span class="mtk6"> false</span></span></span>
<span class="grvsc-line grvsc-line-diff grvsc-line-diff-add"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="35"></span><span class="grvsc-gutter grvsc-diff-add" aria-hidden="true" data-content="+"></span><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9">manufactured</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line grvsc-line-diff grvsc-line-diff-add"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="36"></span><span class="grvsc-gutter grvsc-diff-add" aria-hidden="true" data-content="+"></span><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">type</span><span class="mtk5">:</span><span class="mtk6"> boolean</span></span></span>
<span class="grvsc-line grvsc-line-diff grvsc-line-diff-add"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="37"></span><span class="grvsc-gutter grvsc-diff-add" aria-hidden="true" data-content="+"></span><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">required</span><span class="mtk5">:</span><span class="mtk6"> false</span></span></span></code></pre></div><ol start="7"><li>Publish to exchange - now that we&#x27;ve finished the spec we&#x27;re going to use, click <code>Publish</code> in the top right and then <code>Publish to Exchange</code>. Set the asset version to <code>1.0.0</code> and API version to <code>v1</code>.</li><li>Your published API specification should <a href="https://anypoint.mulesoft.com/exchange/portals/mulesoft-6908/a50f9c0b-44f1-4399-aec5-e75db80327b1/product-system-api/" target="_blank" rel="noreferrer">look like this</a>.</li></ol><h1 id="implementation" style="position:relative"><a href="#implementation" aria-label="implementation permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementation</h1><div class="div-paragraph">Now that we&#x27;ve built our API specification, we can open studio and scaffold our API and provide implementation logic.</div><h3 id="create-project" style="position:relative"><a href="#create-project" aria-label="create project permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create Project</h3><ol><li>Open Anypoint Studio</li><li>Create a new project called &#x27;Product System API&#x27;</li><li>Click the <code>+</code> button to add an API from exchange to the project.</li><li>Sign into your platform account and search for &#x27;Product System API&#x27;</li><li>Create project and scaffold</li></ol><div class="div-paragraph"><div role="button" class="ZoomableImage"><img alt="create-product-api-project.gif" src="/images/create-product-api-project.gif"/></div></div><h3 id="setup-mysql-connection" style="position:relative"><a href="#setup-mysql-connection" aria-label="setup mysql connection permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup MySQL Connection</h3><ol><li>In <code>src/main/resources</code>, create a new file called config.yaml</li><li>Copy the following code into config.yaml:</li></ol><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">yaml</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="yaml" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">mysql</span><span class="mtk5">:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">host</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">services.mythicalcorp.com</span><span class="mtk5">&#x27;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">port</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">3306</span><span class="mtk5">&#x27;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">user</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">product</span><span class="mtk5">&#x27;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">password</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">Mule1379</span><span class="mtk5">&#x27;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">database</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">products_test</span><span class="mtk5">&#x27;</span></span></span></code></pre></div><ol start="3"><li>In the mule palette, click <code>Add Modules</code>, and drag the <code>Database</code> connector into the blue box.</li><li>Click on the <code>Global Elements</code> tab</li><li>Click <code>Create</code> and search for <code>config</code>. Select <code>Configuration properties</code></li><li>Type <code>config.yaml</code> in for the file.</li><li>Click <code>Create</code> and search for <code>database</code>. Select <code>Database config</code></li><li>In the connection dropdown, select <code>MySQL Connection</code></li><li>Under required libraries, click <code>Configure</code> and then click <code>Add recommended libraries</code></li><li>Fill in the following fields:<ul><li>Host: <code>${mysql.host}</code></li><li>Port: <code>${mysql.port}</code></li><li>User: <code>${mysql.user}</code></li><li>Password: <code>${mysql.password}</code> (<strong>tip:</strong> Click on the show password checkbox)</li><li>Database: <code>${mysql.database}</code></li></ul></li><li>Click on <code>Test connection</code> to verify connectivity.</li></ol><div class="div-paragraph"><div role="button" class="ZoomableImage"><img alt="setup-mysql-database-config.gif" src="/images/setup-mysql-database-config.gif"/></div></div><h3 id="create-basic-select-and-map-data" style="position:relative"><a href="#create-basic-select-and-map-data" aria-label="create basic select and map data permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create Basic Select and Map Data</h3><div class="div-paragraph">Now that we have our connectivity setup, we can create the basic implementation of our endpoint: select everything and map to our canonical data model.</div><ol><li>Find the flow <code>get:\producst:product-system-api-config</code> and delete the components</li><li>In the mule palette, select <code>Database</code> and drag a <code>Select</code> operation into the flow</li><li>Select <code>Database_Config</code> in the <code>Connector configuration</code> dropdown</li><li>Paste the following SQL into <code>SQL Query Text</code> (<em>don&#x27;t worry, we will walk through converting this to be dynamic later</em>)</li></ol><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">sql</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="sql" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">SELECT</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  p.id, p.name, p.description, p.product_number, p.manufactured, p.colors, p.categories, p.stock, p.safety_stock_level, p.standard_cost, p.list_price, p.size, p.size_unit_measure_code, p.weight, p.weight_unit_measure_code, p.days_to_manufacture, p.images,  p.modified_date, p.created_date</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">FROM</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  product p</span></span></span></code></pre></div><ol start="5"><li>In the mule palette, find a <code>Transform Message</code> component and add it after our <code>Select</code> component. We need to map our data to our canonical model defined in our spec.</li><li>The <code>Transform Message</code> component should have automatically discovered the metadata; you can now drag and drop the fields to map. Go ahead and map a few fields to give it a try, and then replace the automatically generated data-weave with this code below:</li></ol><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">data-weave</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="data-weave" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3 mtki">%dw</span><span class="mtk1"> </span><span class="mtk3 mtki">2.0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">output</span><span class="mtk1"> </span><span class="mtk6">application/json</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">payload</span><span class="mtk9"> map </span><span class="mtk5">(</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1"> </span><span class="mtk5">,</span><span class="mtk1"> </span><span class="mtk8">indexOfPayload01</span><span class="mtk1"> </span><span class="mtk5">)</span><span class="mtk1"> </span><span class="mtk12">-&gt;</span><span class="mtk1"> </span><span class="mtk5">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  weightUnitMeasureCode</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.weight_unit_measure_code </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  images</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">payload01</span><span class="mtk1">.images </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;)</span><span class="mtk9"> splitBy </span><span class="mtk5">&quot;</span><span class="mtk6">,</span><span class="mtk5">&quot;,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  safetyStockLevel</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.safety_stock_level</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  description</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.description</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  weight</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.weight </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  productCode</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.product_number</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  colors</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">payload01</span><span class="mtk1">.colors </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;)</span><span class="mtk9"> splitBy </span><span class="mtk5">&quot;</span><span class="mtk6">,</span><span class="mtk5">&quot;,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  standardCost</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.standard_cost</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  createdDate</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.created_date </span><span class="mtk5 mtki">as</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  size</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.size </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  sizeUnitMeasure</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.size_unit_measure_code </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  name</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.name</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  modifiedDate</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.modified_date </span><span class="mtk5 mtki">as</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1"> </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  daysToManufacture</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.days_to_manufacture</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  id</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.id</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  categories</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">payload01</span><span class="mtk1">.categories </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;)</span><span class="mtk9"> splitBy </span><span class="mtk5">&quot;</span><span class="mtk6">,</span><span class="mtk5">&quot;,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  stock</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.stock </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  manufactured</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.manufactured</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  listPrice</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk8">payload01</span><span class="mtk1">.list_price</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">}</span></span></span></code></pre></div><ol start="7"><li>Start the app, open the console, and test your api! You should be getting back all Products in the database without any filtering.</li></ol><div class="div-paragraph"><div role="button" class="ZoomableImage"><img alt="product-api-setup-sql-select.gif" src="/images/product-api-setup-sql-select.gif"/></div></div><h3 id="building-dynamic-parameterized-sql" style="position:relative"><a href="#building-dynamic-parameterized-sql" aria-label="building dynamic parameterized sql permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building Dynamic Parameterized SQL</h3><div class="div-paragraph">Implementing the optional <code>manufactured</code> query parameter will be our first path, as this will be the easiest.</div><div class="div-paragraph">In SQL, as in most languages, we can &#x27;short circuit&#x27; our where clause and do something like this:</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">sql</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="sql" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">SELECT</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  p.id, p.name, p.description, p.product_number, p.manufactured, p.colors, p.categories, p.stock, p.safety_stock_level, p.standard_cost, p.list_price, p.size, p.size_unit_measure_code, p.weight, p.weight_unit_measure_code, p.days_to_manufacture, p.images,  p.modified_date, p.created_date</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">FROM</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  product p</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">WHERE</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  (:manufactured </span><span class="mtk4">IS</span><span class="mtk1"> </span><span class="mtk4">NULL</span><span class="mtk1"> </span><span class="mtk4">OR</span><span class="mtk1"> p.manufactured </span><span class="mtk12">=</span><span class="mtk1"> :manufactured)</span></span></span></code></pre></div><div class="div-paragraph">And then in the <code>Input Parameters</code> window, you can click the <code>𝑓x</code> button and paste the following:</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">data-weave</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="data-weave" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  manufactured</span><span class="mtk5">:</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    if</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">attributes</span><span class="mtk1">.queryParams[</span><span class="mtk5">&#x27;</span><span class="mtk6">manufactured</span><span class="mtk5">&#x27;</span><span class="mtk1">]?</span><span class="mtk5">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">      if</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">attributes</span><span class="mtk1">.queryParams[</span><span class="mtk5">&#x27;</span><span class="mtk6">manufactured</span><span class="mtk5">&#x27;</span><span class="mtk1">]</span><span class="mtk5">)</span><span class="mtk1"> </span><span class="mtk4">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk4">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk4">null</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">}</span></span></span></code></pre></div><div class="div-paragraph">By putting this data-weave in the <code>Input Parameters</code> fields, we are passing in parameterized values to our SQL. You should <em>always</em> take this approach when dealing with user input to protect against SQL injection. In our SQL, we are checking if the parameter is null first - if it is we are basically saying <code>if (true === true)</code>, meaning don&#x27;t filter anything. We don&#x27;t need to check if <code>attributes.queryParams.manufactured</code> is actually a boolean; the scaffolding has already validated it. MySQL doesn&#x27;t support booleans and instead stores such information as a 1 or 0, so we have to convert the boolean to a 1 or 0 when parameterizing our value. Our logic is <strong><em>if the key exists, pass 1 for true 0 for false, otherwise pass null</em></strong>. Go ahead and run the API now and see how it does!</div><div class="div-paragraph">One query parameter down - but what about our repeatable parameter? In SQL we know we would do something like <code>p.weight_unit_measure_code IN (&#x27;value1&#x27;, &#x27;value2&#x27;)</code>. What we can&#x27;t do is <code>p.weight_unit_measure_code IN (:values)</code>; unfortunately, the JDBC driver isn&#x27;t going to understand an array. You might be tempted to write some data-weave which manually creates the list of values in the SQL (ie: <code>IN (&#x27;lb&#x27;, &#x27;oz&#x27;)</code>), but <strong>the danger here is that we open ourselves to SQL injection</strong>. What do we need to do? Dynamically generate the parameter key names and the SQL.</div><div class="div-paragraph">Update your SQL block to contain the following; you must include the <code>#[</code> at the beginning and the <code>]</code> at the end as these convert the field value from static text to data-weave; I suggest using the copy code button.</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">data-weave</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="data-weave" data-index="9"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">#[</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">output</span><span class="mtk1"> </span><span class="mtk6">text/plain</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">  SELECT</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">    p.id, p.name, p.description, p.product_number, p.manufactured, p.colors, p.categories, p.stock, p.safety_stock_level, p.standard_cost, p.list_price, p.size, p.size_unit_measure_code, p.weight, p.weight_unit_measure_code, p.days_to_manufacture, p.images,  p.modified_date, p.created_date</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">  FROM </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">    product p</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">  WHERE</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">    (:manufactured IS NULL OR p.manufactured = :manufactured)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk6">  </span><span class="mtk5">&quot;</span><span class="mtk9"> ++ </span><span class="mtk5">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    if</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">attributes</span><span class="mtk1">.queryParams.weightUnitMeasureCode?</span><span class="mtk5">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5">&quot;</span><span class="mtk6"> AND p.weight_unit_measure_code IN (</span><span class="mtk4">$(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">attributes</span><span class="mtk1">.queryParams.*weightUnitMeasureCode</span><span class="mtk9"> map </span><span class="mtk5">&quot;</span><span class="mtk6">:weightUnitMeasureCode_</span><span class="mtk4">$(</span><span class="mtk10">$$</span><span class="mtk4">)</span><span class="mtk5">&quot;</span><span class="mtk9"> joinBy </span><span class="mtk5">&quot;</span><span class="mtk6">,</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk4">)</span><span class="mtk6">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">]</span></span></span></code></pre></div><div class="div-paragraph">This looks confusing, and we&#x27;ll break it down later, but as an example if I made a GET request like <code>?weightUnitMeasureCode=lb&amp;weightUnitMeasureCode=oz</code>, the SQL we pass to the connector will be:</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">sql</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="sql" data-index="10"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">SELECT</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    p.id, p.name, p.description, p.product_number, p.manufactured, p.colors, p.categories, p.stock, p.safety_stock_level, p.standard_cost, p.list_price, p.size, p.size_unit_measure_code, p.weight, p.weight_unit_measure_code, p.days_to_manufacture, p.images,  p.modified_date, p.created_date</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">FROM</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    product p</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">WHERE</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    (:manufactured </span><span class="mtk4">IS</span><span class="mtk1"> </span><span class="mtk4">NULL</span><span class="mtk1"> </span><span class="mtk4">OR</span><span class="mtk1"> p.manufactured </span><span class="mtk12">=</span><span class="mtk1"> :manufactured)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span><span class="mtk4">AND</span><span class="mtk1"> p.weight_unit_measure_code </span><span class="mtk4">IN</span><span class="mtk1"> (:weightUnitMeasureCode_0,:weightUnitMeasureCode_1)</span></span></span></code></pre></div><div class="div-paragraph">Now we get a query string that is still parametrized, where each value gets its own indexed parameter key. In our example, we need our input parameters to look like this:</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">json</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="json" data-index="11"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">&quot;</span><span class="mtk12">weightUnitMeasureCode_0</span><span class="mtk5">&quot;:</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk6">lb</span><span class="mtk5">&quot;,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">&quot;</span><span class="mtk12">weightUnitMeasureCode_1</span><span class="mtk5">&quot;:</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk6">oz</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">}</span></span></span></code></pre></div><div class="div-paragraph">To produce a map like this, our Input Parameters data-weave is going to get a bit more complicated.</div><div class="div-paragraph">Paste the following data-weave into your <code>Input Parameters</code> field</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">data-weave</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="data-weave" data-index="12"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">var</span><span class="mtk1"> </span><span class="mtk7">buildParameterMap</span><span class="mtk1"> </span><span class="mtk12">=</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">weightUnitMeasureCodes</span><span class="mtk5">)</span><span class="mtk1"> </span><span class="mtk12">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    if</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">weightUnitMeasureCodes</span><span class="mtk1"> </span><span class="mtk12">==</span><span class="mtk1"> </span><span class="mtk4">null</span><span class="mtk5">)</span><span class="mtk1"> </span><span class="mtk5">{}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">weightUnitMeasureCodes</span><span class="mtk9"> reduce </span><span class="mtk5">((</span><span class="mtk8">val</span><span class="mtk5">,</span><span class="mtk8">accum</span><span class="mtk12">=</span><span class="mtk5">{})</span><span class="mtk1"> </span><span class="mtk12">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk5">(</span><span class="mtk8">accum</span><span class="mtk1"> </span><span class="mtk12">-</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk6">index</span><span class="mtk5">&quot;),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk5">(&#x27;</span><span class="mtk6">weightUnitMeasureCode_</span><span class="mtk4">$(</span><span class="mtk8">accum</span><span class="mtk1">.index </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk4">0)</span><span class="mtk5">&#x27;):</span><span class="mtk1"> </span><span class="mtk8">val</span><span class="mtk5">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            index</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">accum</span><span class="mtk1">.index </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk5">)</span><span class="mtk1"> </span><span class="mtk12">+</span><span class="mtk1"> </span><span class="mtk4">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">))</span><span class="mtk1"> </span><span class="mtk12">-</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk6">index</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  manufactured</span><span class="mtk5">:</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">    if</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">attributes</span><span class="mtk1">.queryParams[</span><span class="mtk5">&#x27;</span><span class="mtk6">manufactured</span><span class="mtk5">&#x27;</span><span class="mtk1">]?</span><span class="mtk5">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">      if</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">attributes</span><span class="mtk1">.queryParams[</span><span class="mtk5">&#x27;</span><span class="mtk6">manufactured</span><span class="mtk5">&#x27;</span><span class="mtk1">]</span><span class="mtk5">)</span><span class="mtk1"> </span><span class="mtk4">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk4">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk4">null</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">++</span><span class="mtk1"> </span><span class="mtk8">buildParameterMap</span><span class="mtk5">(</span><span class="mtk8">attributes</span><span class="mtk1">.queryParams.*weightUnitMeasureCode</span><span class="mtk5">)</span></span></span></code></pre></div><div class="div-paragraph">Start up the API and give it a test via the API Kit Console located at <a href="http://localhost:8081/console/" target="_blank" rel="noreferrer">http://localhost:8081/console/</a>. You should now be able to filter by multiple <code>weightUnitMeasureCode</code> query parameters.</div><div class="div-paragraph">Our <code>buildParameterMap</code> function takes in the <code>attributes.queryParams.*weightUnitMeasureCode</code> and builds a new map structure, or returns an empty object if the query parameter wasn&#x27;t provided. If you&#x27;re unfamiliar with the <code>.*</code> selector, it exists to select values from a repeated key into a single array, typically used with XML; in this case, we&#x27;re using it to select the multiple query parameters. In the query itself, which we&#x27;ve converted to data-weave with our <code>#[ ]</code>, we are only including the <code>WHERE</code> clause itself if the query parameter was provided.</div><h1 id="bonus-round---making-it-reusable" style="position:relative"><a href="#bonus-round---making-it-reusable" aria-label="bonus round   making it reusable permalink" class="autolink-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bonus Round - Making it Reusable</h1><div class="div-paragraph">This was a lot of work for something that, frankly, isn&#x27;t all that complicated. So to make things easier for ourselves, we can start building a reusable data-weave library.</div><div class="div-paragraph">As a starting point, I&#x27;ve built a few common functions and bundled them into the module <code>dw::sql</code></div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">data-weave</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="data-weave" data-index="13"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3 mtki">%dw</span><span class="mtk1"> </span><span class="mtk3 mtki">2.0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">SELECT</span><span class="mtk1">(</span><span class="mtk10">keys</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">keys</span><span class="mtk1"> </span><span class="mtk5 mtki">match</span><span class="mtk1"> </span><span class="mtk5">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki">case</span><span class="mtk1"> </span><span class="mtk5 mtki">is</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1"> </span><span class="mtk5 mtki">-&gt;</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk6">SELECT </span><span class="mtk4">$(</span><span class="mtk8">keys</span><span class="mtk4">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5 mtki">case</span><span class="mtk1"> </span><span class="mtk5 mtki">is</span><span class="mtk1"> </span><span class="mtk15">Array</span><span class="mtk1">&lt;</span><span class="mtk7">StringCoerceable</span><span class="mtk1">&gt; </span><span class="mtk5 mtki">-&gt;</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk6">SELECT </span><span class="mtk4">$(</span><span class="mtk5">(</span><span class="mtk8">keys</span><span class="mtk1"> </span><span class="mtk5 mtki">default</span><span class="mtk1"> []</span><span class="mtk5">)</span><span class="mtk9"> joinBy </span><span class="mtk5">&#x27;</span><span class="mtk6">, </span><span class="mtk5">&#x27;</span><span class="mtk4">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">FROM</span><span class="mtk1">(</span><span class="mtk10">query</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">tableName</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">query</span><span class="mtk4">)</span><span class="mtk6"> FROM </span><span class="mtk4">$(</span><span class="mtk8">tableName</span><span class="mtk1"> </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk5">&#x27;&#x27;</span><span class="mtk4">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">WHERE</span><span class="mtk1">(</span><span class="mtk10">query</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">where</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">isEmpty</span><span class="mtk5">(</span><span class="mtk8">where</span><span class="mtk5">)</span><span class="mtk1">)</span><span class="mtk9"> query</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">query</span><span class="mtk4">)</span><span class="mtk6"> WHERE </span><span class="mtk4">$(</span><span class="mtk8">where</span><span class="mtk4">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">EQ</span><span class="mtk1">(</span><span class="mtk10">keyName</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">value</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">Any</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">value</span><span class="mtk1"> </span><span class="mtk12">==</span><span class="mtk1"> </span><span class="mtk4">null</span><span class="mtk1">) </span><span class="mtk5">&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">keyName</span><span class="mtk4">)</span><span class="mtk6"> = :</span><span class="mtk4">$(</span><span class="mtk8">keyName</span><span class="mtk4">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">IN</span><span class="mtk1">(</span><span class="mtk10">keyName</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">values</span><span class="mtk1">, </span><span class="mtk10">wrapIn</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1"> </span><span class="mtk12">=</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;</span><span class="mtk1">, </span><span class="mtk10">separateWith</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1"> </span><span class="mtk12">=</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk6">, </span><span class="mtk5">&quot;</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">sizeOf</span><span class="mtk5">(</span><span class="mtk8">values</span><span class="mtk1"> </span><span class="mtk5 mtki">default</span><span class="mtk1"> []</span><span class="mtk5">)</span><span class="mtk1"> </span><span class="mtk12">==</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk1">) </span><span class="mtk5">&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">keyName</span><span class="mtk4">)</span><span class="mtk6"> IN (</span><span class="mtk5">&quot;</span><span class="mtk9"> ++ </span><span class="mtk5">((</span><span class="mtk8">values</span><span class="mtk1"> </span><span class="mtk5 mtki">default</span><span class="mtk1"> []</span><span class="mtk5">)</span><span class="mtk9"> map </span><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">wrapIn</span><span class="mtk4">)</span><span class="mtk6">:</span><span class="mtk4">$(</span><span class="mtk8">keyName</span><span class="mtk4">)</span><span class="mtk6">_</span><span class="mtk4">$(</span><span class="mtk10">$$</span><span class="mtk4">)$(</span><span class="mtk8">wrapIn</span><span class="mtk4">)</span><span class="mtk5">&quot;</span><span class="mtk9"> joinBy </span><span class="mtk8">separateWith</span><span class="mtk5">)</span><span class="mtk9"> ++ </span><span class="mtk5">&quot;</span><span class="mtk6">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">OR</span><span class="mtk1">(</span><span class="mtk10">left</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">right</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">ANDOR</span><span class="mtk5">(</span><span class="mtk8">left</span><span class="mtk5">,</span><span class="mtk1"> </span><span class="mtk8">right</span><span class="mtk5">,</span><span class="mtk1"> </span><span class="mtk4">false</span><span class="mtk5">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">AND</span><span class="mtk1">(</span><span class="mtk10">left</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">right</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">ANDOR</span><span class="mtk5">(</span><span class="mtk8">left</span><span class="mtk5">,</span><span class="mtk1"> </span><span class="mtk8">right</span><span class="mtk5">,</span><span class="mtk1"> </span><span class="mtk4">true</span><span class="mtk5">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">LIMIT</span><span class="mtk1">(</span><span class="mtk10">query</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">limit</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">limit</span><span class="mtk1"> </span><span class="mtk12">==</span><span class="mtk1"> </span><span class="mtk4">null</span><span class="mtk1">) </span><span class="mtk5">&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">query</span><span class="mtk4">)</span><span class="mtk6"> LIMIT </span><span class="mtk4">$(</span><span class="mtk8">limit</span><span class="mtk4">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">OFFSET</span><span class="mtk1">(</span><span class="mtk10">query</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">offset</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">offset</span><span class="mtk1"> </span><span class="mtk12">==</span><span class="mtk1"> </span><span class="mtk4">null</span><span class="mtk1">) </span><span class="mtk5">&quot;&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">query</span><span class="mtk4">)</span><span class="mtk6"> OFFSET </span><span class="mtk4">$(</span><span class="mtk8">offset</span><span class="mtk4">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">MySQL</span><span class="mtk1">_BOOL(</span><span class="mtk10">val</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">val</span><span class="mtk1"> </span><span class="mtk12">==</span><span class="mtk1"> </span><span class="mtk4">null</span><span class="mtk1">) </span><span class="mtk4">null</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">val</span><span class="mtk1">) </span><span class="mtk4">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk4">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">PARAMS</span><span class="mtk1">_EQ(</span><span class="mtk10">keyName</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">value</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">Any</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">value</span><span class="mtk1"> </span><span class="mtk12">==</span><span class="mtk1"> </span><span class="mtk4">null</span><span class="mtk1">) </span><span class="mtk5">{}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">{</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">keyName</span><span class="mtk5">):</span><span class="mtk1"> </span><span class="mtk8">value</span><span class="mtk1"> </span><span class="mtk5">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">PARAMS</span><span class="mtk1">_IN(</span><span class="mtk10">keyName</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">values</span><span class="mtk1">, </span><span class="mtk10">wrapIn</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1"> </span><span class="mtk12">=</span><span class="mtk1"> </span><span class="mtk5">&quot;&quot;</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">sizeOf</span><span class="mtk5">(</span><span class="mtk8">values</span><span class="mtk1"> </span><span class="mtk5 mtki">default</span><span class="mtk1"> []</span><span class="mtk5">)</span><span class="mtk1"> </span><span class="mtk12">==</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk1">) </span><span class="mtk5">{}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">values</span><span class="mtk9"> reduce </span><span class="mtk5">(</span><span class="mtk8">val</span><span class="mtk5">,</span><span class="mtk1"> </span><span class="mtk8">res</span><span class="mtk12">=</span><span class="mtk5">{})</span><span class="mtk1"> </span><span class="mtk12">-&gt;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">res</span><span class="mtk1"> </span><span class="mtk12">-</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk6">index</span><span class="mtk5">&quot;</span><span class="mtk9"> ++ </span><span class="mtk5">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">keyName</span><span class="mtk4">)</span><span class="mtk6">_</span><span class="mtk4">$(</span><span class="mtk8">res</span><span class="mtk1">.index </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk4">0)</span><span class="mtk5">&quot;:</span><span class="mtk1"> </span><span class="mtk8">val</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">}</span><span class="mtk9"> ++ </span><span class="mtk5">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        index</span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">res</span><span class="mtk1">.index </span><span class="mtk5 mtki">default</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk5">)</span><span class="mtk1"> </span><span class="mtk12">+</span><span class="mtk1"> </span><span class="mtk4">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">})</span><span class="mtk1"> </span><span class="mtk12">-</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk6">index</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">fun</span><span class="mtk1"> </span><span class="mtk9">ANDOR</span><span class="mtk1">(</span><span class="mtk10">left</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">right</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">String</span><span class="mtk1">, </span><span class="mtk10">requireBoth</span><span class="mtk12">:</span><span class="mtk1"> </span><span class="mtk7">Boolean</span><span class="mtk1">) </span><span class="mtk12">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">isEmpty</span><span class="mtk5">(</span><span class="mtk8">left</span><span class="mtk5">)</span><span class="mtk1">)</span><span class="mtk9"> right</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else if</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">isEmpty</span><span class="mtk5">(</span><span class="mtk8">right</span><span class="mtk5">))</span><span class="mtk9"> left</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else if</span><span class="mtk1"> </span><span class="mtk5">((</span><span class="mtk8">right</span><span class="mtk9"> contains </span><span class="mtk5">&quot;</span><span class="mtk6"> AND </span><span class="mtk5">&quot;)</span><span class="mtk1"> </span><span class="mtk4">or</span><span class="mtk1"> </span><span class="mtk5">(</span><span class="mtk8">right</span><span class="mtk9"> contains </span><span class="mtk5">&quot;</span><span class="mtk6"> OR </span><span class="mtk5">&quot;))</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">left</span><span class="mtk4">)</span><span class="mtk6"> </span><span class="mtk4">$(</span><span class="mtk5 mtki">if</span><span class="mtk1">(</span><span class="mtk8">requireBoth</span><span class="mtk1">) </span><span class="mtk5">&#x27;</span><span class="mtk6">AND</span><span class="mtk5">&#x27;</span><span class="mtk1"> </span><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">OR</span><span class="mtk5">&#x27;</span><span class="mtk4">)</span><span class="mtk6"> (</span><span class="mtk4">$(</span><span class="mtk8">right</span><span class="mtk4">)</span><span class="mtk6">)</span><span class="mtk5">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">&quot;</span><span class="mtk4">$(</span><span class="mtk8">left</span><span class="mtk4">)</span><span class="mtk6"> </span><span class="mtk4">$(</span><span class="mtk5">(</span><span class="mtk5 mtki">if </span><span class="mtk1">(</span><span class="mtk8">requireBoth</span><span class="mtk1">) </span><span class="mtk5">&#x27;</span><span class="mtk6">AND</span><span class="mtk5">&#x27;</span><span class="mtk1"> </span><span class="mtk5 mtki">else</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">OR</span><span class="mtk5">&#x27;)</span><span class="mtk4">)</span><span class="mtk6"> </span><span class="mtk4">$(</span><span class="mtk8">right</span><span class="mtk4">)</span><span class="mtk5">&quot;</span></span></span></code></pre></div><div class="div-paragraph">This now lets us convert our SQL Query Text to this far more succinct script:</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">data-weave</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="data-weave" data-index="14"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">#[</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">import</span><span class="mtk1"> * </span><span class="mtk12">from</span><span class="mtk1"> </span><span class="mtk7">dw::sql</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">output</span><span class="mtk1"> </span><span class="mtk6">text/plain</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">SELECT</span><span class="mtk5">(</span><span class="mtk1">[</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">&#x27;</span><span class="mtk6">id</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">name</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">description</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">product_number</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">manufactured</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">&#x27;</span><span class="mtk6">colors</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">categories</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">stock</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">safety_stock_level</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">&#x27;</span><span class="mtk6">standard_cost</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">list_price</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">size</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">size_unit_measure_code</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">&#x27;</span><span class="mtk6">weight</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">weight_unit_measure_code</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">images</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk5">&#x27;</span><span class="mtk6">modified_date</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">&#x27;</span><span class="mtk6">created_date</span><span class="mtk5">&#x27;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  ]</span><span class="mtk5">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">FROM</span><span class="mtk5">(&#x27;</span><span class="mtk6">product</span><span class="mtk5">&#x27;)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">WHERE</span><span class="mtk5">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">EQ</span><span class="mtk5">(&#x27;</span><span class="mtk6">manufactured</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk8">MySQL_BOOL</span><span class="mtk5">(</span><span class="mtk8">attributes</span><span class="mtk1">.queryParams[</span><span class="mtk5">&#x27;</span><span class="mtk6">manufactured</span><span class="mtk5">&#x27;</span><span class="mtk1">]</span><span class="mtk5">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">AND</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">IN</span><span class="mtk5">(&#x27;</span><span class="mtk6">weight_unit_measure_code</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk8">attributes</span><span class="mtk1">.queryParams.*weightUnitMeasureCode</span><span class="mtk5">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk10">]</span></span></span></code></pre></div><div class="div-paragraph">And our input parameters to:</div><div class="codeWrapper"><button class="CopyCodeButton">Copy</button><div class="CodeLanguageStub">data-weave</div><div class="ConfettiWrapper"><div style="position:relative"></div></div><pre class="grvsc-container community-material-theme-palenight" data-language="data-weave" data-index="15"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">import</span><span class="mtk1"> * </span><span class="mtk12">from</span><span class="mtk1"> </span><span class="mtk7">dw::sql</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">(</span><span class="mtk8">PARAMS_EQ</span><span class="mtk5">(&#x27;</span><span class="mtk6">manufactured</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk8">MySQL_BOOL</span><span class="mtk5">(</span><span class="mtk8">attributes</span><span class="mtk1">.queryParams[</span><span class="mtk5">&#x27;</span><span class="mtk6">manufactured</span><span class="mtk5">&#x27;</span><span class="mtk1">]</span><span class="mtk5">))),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">(</span><span class="mtk8">PARAMS_IN</span><span class="mtk5">(&#x27;</span><span class="mtk6">weight_unit_measure_code</span><span class="mtk5">&#x27;,</span><span class="mtk1"> </span><span class="mtk8">attributes</span><span class="mtk1">.queryParams.*weightUnitMeasureCode</span><span class="mtk5">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">}</span></span></span></code></pre></div><div class="div-paragraph">By taking these functions and building a reusable library that handles the logic for us, we make our lives much easier the next time around!</div><style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &#x27; &#x27;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &#x27; &#x27;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .community-material-theme-palenight {
    background-color: #292D3E;
    color: #A6ACCD;
  }
  .community-material-theme-palenight .mtki { font-style: italic; }
  .community-material-theme-palenight .mtk4 { color: #F78C6C; }
  .community-material-theme-palenight .mtk9 { color: #82AAFF; }
  .community-material-theme-palenight .mtk5 { color: #89DDFF; }
  .community-material-theme-palenight .mtk6 { color: #C3E88D; }
  .community-material-theme-palenight .mtk1 { color: #FFFFFF; }
  .community-material-theme-palenight .mtk15 { color: #B2CCD6; }
  .community-material-theme-palenight .mtk11 { color: #F07178; }
  .community-material-theme-palenight .mtk3 { color: #676E95; }
  .community-material-theme-palenight .mtk12 { color: #C792EA; }
  .community-material-theme-palenight .mtk8 { color: #A6ACCD; }
  .community-material-theme-palenight .mtk7 { color: #FFCB6B; }
  .community-material-theme-palenight .mtk10 { color: #FF5370; }
  .community-material-theme-palenight .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/2020/optional-query-params-dynamic-sql/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-f5ec1ff06108d0c85bab.js"],"app":["/app-22d52c2ef2be2623c7f4.js"],"component---src-pages-404-js":["/component---src-pages-404-js-0d65b0984ce0dd3bfa05.js"],"component---src-templates-index-js":["/component---src-templates-index-js-9cc22a22addd47368c69.js"],"component---src-templates-labs-by-category-js":["/component---src-templates-labs-by-category-js-973fcc1462039ce127cc.js"],"component---src-templates-labs-js":["/component---src-templates-labs-js-4e36ac36c454f92e53fa.js"],"component---src-templates-post-js":["/component---src-templates-post-js-035094637a182b1c4701.js"],"component---src-templates-posts-by-tags-js":["/component---src-templates-posts-by-tags-js-b25cfef693d82f7d8f5c.js"]};/*]]>*/</script><script src="/polyfill-f5ec1ff06108d0c85bab.js" nomodule=""></script><script src="/component---src-templates-post-js-035094637a182b1c4701.js" async=""></script><script src="/417f07d9c8fb71f0b05fb9fb3720dd621d3ab4d5-1102b991d7103fbe13c4.js" async=""></script><script src="/commons-4dbdc3f7f9faad9c4cbc.js" async=""></script><script src="/a9a7754c-34b8923232843e7049e0.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-22d52c2ef2be2623c7f4.js" async=""></script><script src="/framework-cd3e1e804d552fa282ef.js" async=""></script><script src="/webpack-runtime-732d6374192569e2f284.js" async=""></script></body></html>